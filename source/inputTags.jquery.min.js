!function(t){t.fn.inputTags=function(e){if("inputTags"in window||(window.inputTags={instances:[]}),window.inputTags.methods={tags:function(t,e){if(t){switch(typeof t){case"string":switch(t){case"_toString":var n=o.tags.toString();return e?e(n):n;case"_toObject":var i=o._toObject(o.tags);return e?e(i):i;case"_toJSON":i=o._toObject(o.tags);var a=JSON.stringify(i);return e?e(a):a;case"_toArray":return e?e(o.tags):o.tags}var s=t.split(",");if(s.length>1){var u=o.tags;o.tags=u.concat(s)}else o.tags.push(s[0]);break;case"object":u=o.tags;"[object Object]"===Object.prototype.toString.call(t)&&(t=Object.keys(t).map(function(e){return t[e]})),o.tags=u.concat(t);break;case"function":return t(o.tags)}if(o._clean(),o._fill(),o._updateValue(),o.destroy(),o._setInstance(o),e)return e(o.tags)}return o.tags},event:function(t,e){o.options[t]=e,o._setInstance(o)},options:function(t,e){return t||e?e?(o.options[t]=e,void o._setInstance(o)):o.options[t]:o.options},destroy:function(){var e=t(this).attr("data-uniqid");delete window.inputTags.instances[e]}},"object"==typeof e||!e){e=t.extend(!0,{},t.fn.inputTags.defaults,e),this.each(function(){var n=t(this);n.UNIQID=Math.round(Date.now()/(494*Math.random()-54)),n.DEFAULT_CLASS="inputTags",n.ELEMENT_CLASS=n.DEFAULT_CLASS+"-"+n.UNIQID,n.LIST_CLASS=n.DEFAULT_CLASS+"-list",n.ITEM_CLASS=n.DEFAULT_CLASS+"-item",n.ITEM_CONTENT='<span class="value" title="">%s</span><i class="close-item">&times</i>',n.FIELD_CLASS=n.DEFAULT_CLASS+"-field",n.ERROR_CLASS=n.DEFAULT_CLASS+"-error",n.ERROR_CONTENT='<p class="'+n.ERROR_CLASS+'">%s</p>',n.AUTOCOMPLETE_LIST_CLASS=n.DEFAULT_CLASS+"-autocomplete-list",n.AUTOCOMPLETE_ITEM_CLASS=n.DEFAULT_CLASS+"-autocomplete-item",n.AUTOCOMPLETE_ITEM_CONTENT='<li class="'+n.AUTOCOMPLETE_ITEM_CLASS+'">%s</li>',n.options=e,n.keys=[13,188,27],n.tags=[],n.options.keys.length>0&&(n.keys=n.keys.concat(n.options.keys)),n.init=function(){n.addClass(n.ELEMENT_CLASS).attr("data-uniqid",n.UNIQID),n.$element=t("."+n.ELEMENT_CLASS),n.$element.hide(),n.build(),n.fill(),n.save(),n.edit(),n.destroy(),n._autocomplete()._init(),n._focus()},n.build=function(){n.$html=t("<div>").addClass(n.LIST_CLASS),apex.debug.log("Input disabled",!n.options.editable),n.$input=t("<input>").attr({type:"text",class:n.FIELD_CLASS,disabled:!n.options.editable}),n.$html.insertAfter(n.$element).prepend(n.$input),n.$list=n.$element.next("."+n.LIST_CLASS),n.$list.on("click",function(e){if(t(e.target).hasClass("inputTags-field"))return!1;n.$input.focus()})},n.fill=function(){if(n._getDefaultValues(),0===n.options.tags)return!1;n._concatenate(),n._updateValue(),n._fill()},n._fill=function(){n.tags.forEach(function(t,e){var o=n._validate(t,!1);(!0===o||"max"===o&&e+1<=n.options.max)&&n._buildItem(t)})},n._clean=function(){t("."+n.ITEM_CLASS,n.$list).remove()},n.save=function(){n.$input.on("keyup",function(e){e.preventDefault();var o=e.keyCode||e.which,i=n.$input.val().trim();if(t.inArray(o,n.keys)<0)return!1;if(27===o)return n._cancel(),!1;if(i=188===o?i.slice(0,-1):i,!n._validate(i,!0))return!1;if(n.options.only&&n._exists(i))return n._errors("exists"),!1;if(n.$input.hasClass("is-edit")){var a=n.$input.attr("data-old-value");if(a===i)return n._cancel(),!0;n._update(a,i),n._clean(),n._fill()}else{if(n._autocomplete()._isSet()&&n._autocomplete()._get("only")&&t.inArray(i,n._autocomplete()._get("values"))<0)return n._autocomplete()._hide(),n._errors("autocomplete_only"),!1;if(n._exists(i)){n.$input.removeClass("is-autocomplete"),n._errors("exists");var s=t('[data-tag="'+i+'"]',n.$list);return s.addClass("is-exists"),setTimeout(function(){s.removeClass("is-exists")},300),!1}n._buildItem(i),n._insert(i)}return n._cancel(),n._updateValue(),n.destroy(),n._autocomplete()._build(),n._setInstance(n),n.$input.focus(),!1})},n.edit=function(){n.$list.on("click","."+n.ITEM_CLASS,function(e){if(t(e.target).hasClass("close-item"))return n._cancel(),!0;var o=t(this).attr("data-tag");apex.debug.log("Tag value : ",o),apex.debug.log("Passed url from page mode: ",n.options.url,n.options.pagemode);var i=n.options.url;if(i.length>0){var a=i.replace("!TAG!",o);apex.debug.log("Target: ",a),"modal"==n.options.pagemode?apex.navigation.dialog.close(!0,a):apex.navigation.redirect(a)}})},n.destroy=function(){if(apex.debug.log("Destroy/editable:",n.options.destroy,n.options.editable),!1===n.options.destroy)return!0;t("."+n.ITEM_CLASS,n.$list).off("click").on("click",".close-item",function(){var e=t(this).parent("."+n.ITEM_CLASS),o=t(".value",e).text();e.addClass("is-closed"),setTimeout(function(){n._pop(o),n._updateValue(),e.remove(),n._autocomplete()._build(),n.$input.focus(),n._setInstance(n)},200)})},n._buildItem=function(e){var o=t(n.ITEM_CONTENT.replace("%s",e));t("<span>").addClass(n.ITEM_CLASS+" is-closed").attr("data-tag",e).html(o).insertBefore(n.$input).delay(100).queue(function(){t(this).removeClass("is-closed")})},n._getIndex=function(t){return n.tags.indexOf(t)},n._concatenate=function(){(!1===typeof n.options.max||n.options.max>0)&&n.options.tags.length>n.options.max&&n.options.tags.splice(-Math.abs(n.options.tags.length-n.options.max)),n.tags=n.tags.concat(n.options.tags)},n._getDefaultValues=function(){n.$element.val().length>0?n.tags=n.tags.concat(n.$element.val().split(",")):n.$element.prop("value","")},n._insert=function(t){n.tags.push(t),n._bindEvent(["change","create"])},n._update=function(t,e){var o=n._getIndex(t);n.tags[o]=e,n._bindEvent(["change","update"])},n._pop=function(t){var e=n._getIndex(t);if(e<0)return!1;n.tags.splice(e,1),n._bindEvent(["change","destroy"])},n._cancel=function(){t("."+n.ITEM_CLASS).removeClass("is-edit"),n.$input.removeClass("is-edit is-autocomplete").removeAttr("data-old-value style").val("").appendTo(n.$list)},n._autocomplete=function(){var e=n.options.autocomplete.values;return{_isSet:function(){return e.length>0},_init:function(){if(!n._autocomplete()._isSet())return!1;n._autocomplete()._build()},_build:function(){n._autocomplete()._exists()&&n.$autocomplete.remove(),n.$autocomplete=t("<ul>").addClass(n.AUTOCOMPLETE_LIST_CLASS),n._autocomplete()._get("values").forEach(function(e,o){var i=n.AUTOCOMPLETE_ITEM_CONTENT.replace("%s",e);(t.inArray(e,n.tags)>=0?t(i).addClass("is-disabled"):t(i)).appendTo(n.$autocomplete)}),n._autocomplete()._bindClick(),t(document).not(n.$autocomplete).on("click",function(){n._autocomplete()._hide()})},_bindClick:function(){t(n.$autocomplete).off("click").on("click","."+n.AUTOCOMPLETE_ITEM_CLASS,function(e){if(t(e.target).hasClass("is-disabled"))return!1;n.$input.addClass("is-autocomplete").val(t(this).text()),n._autocomplete()._hide(),n._bindEvent("autocompleteTagSelect"),(e=t.Event("keyup")).which=13,n.$input.trigger(e)})},_show:function(){if(!n._autocomplete()._isSet())return!1;n.$autocomplete.css({left:n.$input[0].offsetLeft,minWidth:n.$input.width()}).insertAfter(n.$input),setTimeout(function(){n._autocomplete()._bindClick(),n.$autocomplete.addClass("is-active")},100)},_hide:function(){n.$autocomplete.removeClass("is-active")},_get:function(t){return n.options.autocomplete[t]},_exists:function(){return void 0!==n.$autocomplete}}},n._updateValue=function(){n.$element.prop("value",n.tags.join(","))},n._focus=function(){n.$input.on("focus",function(){n._bindEvent("focus"),!n._autocomplete()._isSet()||n.$input.hasClass("is-autocomplete")||n.$input.hasClass("is-edit")||n._autocomplete()._show()})},n._toObject=function(t){return t.reduce(function(t,e,n){return t[n]=e,t},{})},n._validate=function(t,e){var o="";switch(!0){case!t:case void 0===t:case 0===t.length:n._cancel(),o="empty";break;case t.length>0&&t.length<n.options.minLength:o="minLength";break;case t.length>n.options.maxLength:o="maxLength";break;case n.options.max>0&&n.tags.length>=n.options.max:n.$input.hasClass("is-edit")||(o="max");break;case n.options.email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)||(o="email")}return!(o.length>0)||(e?n._errors(o):o)},n._exists=function(e){return t.inArray(e,n.tags)>=0},n._errors=function(t){return 0!==t.length&&(n._autocomplete()._exists()&&n.$autocomplete.remove(),n._displayErrors(n.options.errors[t].replace("%s",n.options[t]),t),!1)},n._displayErrors=function(e,o){var i=t(n.ERROR_CONTENT.replace("%s",e)).attr("data-error",o),a=n.options.errors.timeout;return!t("."+n.ERROR_CLASS+'[data-error="'+o+'"]').length&&(i.hide().insertAfter(n.$list).slideDown(),!(!a||a<=0)&&(t("."+n.ERROR_CLASS).on("click",function(){n._collapseErrors(t(this))}),void setTimeout(function(){n._collapseErrors()},a)))},n._collapseErrors=function(e){var o=e||t("."+n.ERROR_CLASS);o.slideUp(300,function(){o.remove()})},n._getInstance=function(){return window.inputTags.instances[n.UNIQID]},n._setInstance=function(t){window.inputTags.instances[n.UNIQID]=n},n._isSet=function(t){return!(void 0===n.options[t]||!1===n.options[t]||n.options[t].length<=0)},n._callMethod=function(t,e){if(void 0===e.options[t]||"function"!=typeof e.options[t])return!1;e.options[t].apply(this,Array.prototype.slice.call(arguments,1))},n._initEvent=function(t,e){if(!t)return!1;switch(typeof t){case"string":e(t,n);break;case"object":t.forEach(function(t,o){e(t,n)})}return!0},n._bindEvent=function(t){return n._initEvent(t,function(t,e){n._callMethod(t,e)})},n._unbindEvent=function(t){return n._initEvent(t,function(t,e){n.options[t]=!1})},n.init(),n._bindEvent("init"),n._setInstance(n)});return{on:function(t,e){window.inputTags.methods.event(t,e)}}}if(window.inputTags.methods[e]){var n=t(this).attr("data-uniqid"),o=window.inputTags.instances[n];return void 0===o?t.error("[undefined instance] No inputTags instance found."):window.inputTags.methods[e].apply(this,Array.prototype.slice.call(arguments,1))}t.error("[undefined method] The method ["+e+"] does not exists.")},t.fn.inputTags.defaults={url:"",pagemode:"normal",tags:[],keys:[],minLength:2,maxLength:30,max:6,email:!1,only:!0,init:!1,create:!1,update:!1,destroy:!1,focus:!1,selected:!1,unselected:!1,change:!1,autocompleteTagSelect:!1,editable:!0,autocomplete:{values:[],only:!1},errors:{empty:"You cannot add an empty tag.",minLength:"The minimum length of a tag is %s characters.",maxLength:"The maximum length of a tag is %s characters.",max:"The number of tags cannot be more than %s.",email:"This is not a valid email address.",exists:"This tag was already added.",autocomplete_only:"You can only select a value from the list.",timeout:8e3}}}(jQuery);